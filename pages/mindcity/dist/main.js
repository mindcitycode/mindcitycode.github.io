(()=>{var t=[function(t){t.exports=function(){"use strict";function t(t,i,r,o,a){!function t(n,i,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,h=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(h-s/2<0?-1:1);t(n,i,Math.max(r,Math.floor(i-h*c/s+u)),Math.min(o,Math.floor(i+(s-h)*c/s+u)),a)}var m=n[i],f=r,d=o;for(e(n,r,i),a(n[o],m)>0&&e(n,r,o);f<d;){for(e(n,f,d),f++,d--;a(n[f],m)<0;)f++;for(;a(n[d],m)>0;)d--}0===a(n[r],m)?e(n,r,d):e(n,++d,o),d<=i&&(r=d+1),i<=d&&(o=d-1)}}(t,i,r||0,o||t.length-1,a||n)}function e(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function n(t,e){return t<e?-1:t>e?1:0}var i=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,i,r){r||(r=d(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<n;o++){var a=t.children[o];s(r,t.leaf?i(a):a)}return r}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(e,n,i,r,o){for(var a=[n,i];a.length;)if(!((i=a.pop())-(n=a.pop())<=r)){var s=n+Math.ceil((i-n)/r/2)*r;t(e,s,n,i,o),a.push(n,s,s,i)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var e=this.data,n=[];if(!f(t,e))return n;for(var i=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?i(a):a;f(t,s)&&(e.leaf?n.push(a):m(t,s)?this._all(a,n):r.push(a))}e=r.pop()}return n},i.prototype.collides=function(t){var e=this.data;if(!f(t,e))return!1;for(var n=[];e;){for(var i=0;i<e.children.length;i++){var r=e.children[i],o=e.leaf?this.toBBox(r):r;if(f(t,o)){if(e.leaf||m(t,o))return!0;n.push(r)}}e=n.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=d([]),this},i.prototype.remove=function(t,e){if(!t)return this;for(var n,i,o,a=this.data,s=this.toBBox(t),h=[],l=[];a||h.length;){if(a||(a=h.pop(),i=h[h.length-1],n=l.pop(),o=!0),a.leaf){var c=r(t,a.children,e);if(-1!==c)return a.children.splice(c,1),h.push(a),this._condense(h),this}o||a.leaf||!m(a,s)?i?(n++,a=i.children[n],o=!1):a=null:(h.push(a),l.push(n),n=0,i=a,a=a.children[0])}return this},i.prototype.toBBox=function(t){return t},i.prototype.compareMinX=function(t,e){return t.minX-e.minX},i.prototype.compareMinY=function(t,e){return t.minY-e.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},i.prototype._build=function(t,e,n,i){var r,a=n-e+1,s=this._maxEntries;if(a<=s)return o(r=d(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,i-1))),(r=d([])).leaf=!1,r.height=i;var h=Math.ceil(a/s),l=h*Math.ceil(Math.sqrt(s));p(t,e,n,l,this.compareMinX);for(var c=e;c<=n;c+=l){var u=Math.min(c+l-1,n);p(t,c,u,h,this.compareMinY);for(var m=c;m<=u;m+=h){var f=Math.min(m+h-1,u);r.children.push(this._build(t,m,f,i-1))}}return o(r,this.toBBox),r},i.prototype._chooseSubtree=function(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){for(var r=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var h=e.children[s],l=c(h),u=(m=t,f=h,(Math.max(f.maxX,m.maxX)-Math.min(f.minX,m.minX))*(Math.max(f.maxY,m.maxY)-Math.min(f.minY,m.minY))-l);u<o?(o=u,r=l<r?l:r,a=h):u===o&&l<r&&(r=l,a=h)}e=a||e.children[0]}var m,f;return e},i.prototype._insert=function(t,e,n){var i=n?t:this.toBBox(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),s(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},i.prototype._split=function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var a=this._chooseSplitIndex(n,r,i),s=d(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},i.prototype._splitRoot=function(t,e){this.data=d([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(t,e,n){for(var i,r,o,s,h,l,u,m=1/0,f=1/0,d=e;d<=n-e;d++){var p=a(t,0,d,this.toBBox),g=a(t,d,n,this.toBBox),y=(r=p,o=g,s=void 0,h=void 0,l=void 0,u=void 0,s=Math.max(r.minX,o.minX),h=Math.max(r.minY,o.minY),l=Math.min(r.maxX,o.maxX),u=Math.min(r.maxY,o.maxY),Math.max(0,l-s)*Math.max(0,u-h)),x=c(p)+c(g);y<m?(m=y,i=d,f=x<f?x:f):y===m&&x<f&&(f=x,i=d)}return i||n-e},i.prototype._chooseSplitAxis=function(t,e,n){var i=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},i.prototype._allDistMargin=function(t,e,n,i){t.children.sort(i);for(var r=this.toBBox,o=a(t,0,e,r),h=a(t,n-e,n,r),l=u(o)+u(h),c=e;c<n-e;c++){var m=t.children[c];s(o,t.leaf?r(m):m),l+=u(o)}for(var f=n-e-1;f>=e;f--){var d=t.children[f];s(h,t.leaf?r(d):d),l+=u(h)}return l},i.prototype._adjustParentBBoxes=function(t,e,n){for(var i=n;i>=0;i--)s(e[i],t)},i.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},i}()}],e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t,e={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},i={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},r={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},o=256,a=65536,s=(t=4,e=>Math.ceil(e/t)*t),h=Symbol("storeRef"),l=Symbol("storeSize"),c=Symbol("storeMaps"),u=Symbol("storeFlattened"),m=Symbol("storeBase"),f=Symbol("storeType"),d=Symbol("storeArrayElementCounts"),p=Symbol("storeSubarrays"),g=Symbol("subarrayCursors"),y=Symbol("subarray"),x=(Symbol("subarrayFrom"),Symbol("subarrayTo"),Symbol("parentArray")),b=Symbol("tagStore"),v=(Symbol("queryShadow"),Symbol("serializeShadow"),Symbol("indexType")),w=Symbol("indexBytes"),S=Symbol("isEidType"),M={},E=(t,e)=>{const n=new ArrayBuffer(e*t.BYTES_PER_ELEMENT),i=new t.constructor(n);return i.set(t,0),i},A=(t,e)=>{if(ArrayBuffer.isView(t))t[e]=t.slice(0);else{const n=t[x].slice(0);t[e]=t.map(((e,i)=>{const{length:r}=t[i],o=r*i,a=o+r;return n.subarray(o,a)}))}},Y=(t,n,h)=>{Object.keys(n).forEach((l=>{const c=n[l];Array.isArray(c)?(((t,n,h)=>{const l=t[g];let c=n[f];const u=n[0].length,m=u<=o?e.ui8:u<=a?e.ui16:e.ui32;if(0===l[c]){const e=t[d][c],n=new r[c](s(e*h));n.set(t[p][c]),t[p][c]=n,n[v]=i[m],n[w]=r[m].BYTES_PER_ELEMENT}const b=l[c],S=b+h*u;l[c]=S,n[x]=t[p][c].subarray(b,S);for(let t=0;t<h;t++){const e=u*t,o=e+u;n[t]=n[x].subarray(e,o),n[t][v]=i[m],n[t][w]=r[m].BYTES_PER_ELEMENT,n[t][y]=!0}})(t,c,h),n[u].push(c)):ArrayBuffer.isView(c)?(n[l]=E(c,h),n[u].push(n[l])):"object"==typeof c&&Y(t,n[l],h)}))},k=(t,e)=>{t[b]||(t[l]=e,t[u].length=0,Object.keys(t[g]).forEach((e=>{t[g][e]=0})),Y(t,t,e))},_=(t,e)=>{t[u]&&t[u].forEach((t=>{ArrayBuffer.isView(t)?t[e]=0:t[e].fill(0)}))},X=t=>Array.isArray(t)&&"string"==typeof t[0]&&"number"==typeof t[1],B=(t,n)=>{const E=Symbol("store");if(!t||!Object.keys(t).length)return M[E]={[l]:n,[b]:!0,[m]:()=>M[E]},M[E];t=JSON.parse(JSON.stringify(t));const A={},Y=t=>{const e=Object.keys(t);for(const n of e)X(t[n])?(A[t[n][0]]||(A[t[n][0]]=0),A[t[n][0]]+=t[n][1]):t[n]instanceof Object&&Y(t[n])};Y(t);const k={[l]:n,[c]:{},[p]:{},[h]:E,[g]:Object.keys(r).reduce(((t,e)=>({...t,[e]:0})),{}),[u]:[],[d]:A};if(t instanceof Object&&Object.keys(t).length){const h=(t,c)=>{if("string"==typeof t[c])t[c]=((t,n)=>{const i=n*r[t].BYTES_PER_ELEMENT,o=new ArrayBuffer(i),a=new r[t](o);return a[S]=t===e.eid,a})(t[c],n),t[c][m]=()=>M[E],k[u].push(t[c]);else if(X(t[c])){const[n,h]=t[c];t[c]=((t,n,h)=>{const c=t[l],u=Array(c).fill(0);u[f]=n,u[S]=n===e.eid;const m=t[g],b=h<=o?e.ui8:h<=a?e.ui16:e.ui32;if(!h)throw new Error("bitECS - Must define component array length");if(!r[n])throw new Error(`bitECS - Invalid component array property type ${n}`);if(!t[p][n]){const e=t[d][n],o=new r[n](s(e*c));o[v]=i[b],o[w]=r[b].BYTES_PER_ELEMENT,t[p][n]=o}const M=m[n],E=M+c*h;m[n]=E,u[x]=t[p][n].subarray(M,E);for(let t=0;t<c;t++){const e=h*t,n=e+h;u[t]=u[x].subarray(e,n),u[t][v]=i[b],u[t][w]=r[b].BYTES_PER_ELEMENT,u[t][y]=!0}return u})(k,n,h),t[c][m]=()=>M[E],k[u].push(t[c])}else t[c]instanceof Object&&(t[c]=Object.keys(t[c]).reduce(h,t[c]));return t};return M[E]=Object.assign(Object.keys(t).reduce(h,t),k),M[E][m]=()=>M[E],M[E]}},I=()=>{const t=[],e=[];t.sort=function(n){const i=Array.prototype.sort.call(this,n);for(let n=0;n<t.length;n++)e[t[n]]=n;return i};const n=n=>t[e[n]]===n;return{add:i=>{n(i)||(e[i]=t.push(i)-1)},remove:i=>{if(!n(i))return;const r=e[i],o=t.pop();o!==i&&(t[r]=o,e[o]=r)},has:n,sparse:e,dense:t}},O=t=>e=>!t(e),T=t=>t[u],R=T,L=(O(R),t=>"function"==typeof t),P=(O(L),Symbol("entityMasks")),C=Symbol("entityComponents"),j=Symbol("entitySparseSet"),U=Symbol("entityArray"),N=(Symbol("entityIndices"),Symbol("removedEntities"),1e5),D=0,q=N,F=()=>q,V=[],Q=t=>{const e=q;q=N=t,D=0,V.length=0,q=t,Yt(t),dt(t),!0,console.info(`👾 bitECS - resizing all data stores from ${e} to ${t}`)},z=new Map,J=t=>{if(D>=q-q/5){const t=q,e=4*Math.ceil(t/2/4);Q(t+e)}const e=V.length>Math.round(.01*N)?V.shift():D++;return t[j].add(e),z.set(e,t),t[K].forEach((n=>{st(t,n,e)&&ht(n,e)})),t[C].set(e,new Set),e};var $=Symbol("queries"),K=Symbol("notQueries"),W=Symbol("queryAny"),H=Symbol("queryAll"),G=Symbol("queryNone"),Z=Symbol("queryMap"),tt=Symbol("$dirtyQueries"),et=Symbol("queryComponents"),nt=(Symbol("enterQuery"),Symbol("exitQuery"),(t,e)=>{const n=[],i=[],r=[];e[et].forEach((e=>{if("function"==typeof e){const[o,a]=e();t[mt].has(o)||gt(t,o),"not"===a&&i.push(o),"changed"===a&&(r.push(o),n.push(o))}else t[mt].has(e)||gt(t,e),n.push(e)}));const o=e=>t[mt].get(e),a=n.concat(i).map(o),s=I(),h=I(),l=I(),c=I(),m=a.map((t=>t.generationId)).reduce(((t,e)=>(t.includes(e)||t.push(e),t)),[]),f=(t,e)=>(t[e.generationId]||(t[e.generationId]=0),t[e.generationId]|=e.bitflag,t),d=n.map(o).reduce(f,{}),p=i.map(o).reduce(f,{}),g=a.reduce(f,{}),y=n.filter((t=>!t[b])).map((t=>Object.getOwnPropertySymbols(t).includes(u)?t[u]:[t])).reduce(((t,e)=>t.concat(e)),[]),x=Object.assign(s,{archetypes:[],changed:[],components:n,notComponents:i,changedComponents:r,allComponents:a,masks:d,notMasks:p,hasMasks:g,generations:m,flatProps:y,toRemove:h,entered:l,exited:c,shadows:[]});t[Z].set(e,x),t[$].add(x),a.forEach((t=>{t.queries.add(x)})),i.length&&t[K].add(x);for(let e=0;e<D;e++){if(!t[j].has(e))continue;st(t,x,e)&&ht(x,e)}}),it=(t,e)=>{const n=Symbol(),i=t.flatProps[e];return A(i,n),t.shadows[e]=i[n],i[n]},rt=(t,e)=>t.concat(e),ot=t=>e=>e.filter((e=>e.name===t().constructor.name)).reduce(rt),at=(ot((function(...t){return function(){return t}})),ot((function(...t){return function(){return t}})),ot((function(...t){return function(){return t}})),(...t)=>{let e;if(Array.isArray(t[0])&&(e=t[0]),void 0===e||void 0!==e[mt])return t=>t?t[U]:e[U];const n=function(t,e=!0){t[Z].has(n)||nt(t,n);const i=t[Z].get(n);return ct(t),i.changedComponents.length?((t,e)=>{e&&(t.changed=[]);const{flatProps:n,shadows:i}=t;for(let e=0;e<t.dense.length;e++){const r=t.dense[e];let o=!1;for(let e=0;e<n.length;e++){const a=n[e],s=i[e]||it(t,e);if(ArrayBuffer.isView(a[r])){for(let t=0;t<a[r].length;t++)if(a[r][t]!==s[r][t]){o=!0;break}s[r].set(a[r])}else a[r]!==s[r]&&(o=!0,s[r]=a[r])}o&&t.changed.push(r)}return t.changed})(i,e):i.dense};return n[et]=e,n[W]=undefined,n[H]=undefined,n[G]=undefined,n}),st=(t,e,n)=>{const{masks:i,notMasks:r,generations:o}=e;for(let e=0;e<o.length;e++){const a=o[e],s=i[a],h=r[a],l=t[P][a][n];if(h&&0!=(l&h))return!1;if(s&&(l&s)!==s)return!1}return!0},ht=(t,e)=>{t.toRemove.remove(e),t.entered.add(e),t.add(e)},lt=t=>{for(let e=t.toRemove.dense.length-1;e>=0;e--){const n=t.toRemove.dense[e];t.toRemove.remove(n),t.remove(n)}},ct=t=>{t[tt].size&&(t[tt].forEach(lt),t[tt].clear())},ut=(t,e,n)=>{e.has(n)&&!e.toRemove.has(n)&&(e.toRemove.add(n),t[tt].add(e),e.exited.add(n))},mt=Symbol("componentMap"),ft=[],dt=t=>{ft.forEach((e=>k(e,t)))},pt=(t,e)=>{const n=B(t,e||F());return t&&Object.keys(t).length&&ft.push(n),n},gt=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");const n=new Set,i=new Set,r=new Set;t[$].forEach((t=>{t.allComponents.includes(e)&&n.add(t)})),t[mt].set(e,{generationId:t[P].length-1,bitflag:t[wt],store:e,queries:n,notQueries:i,changedQueries:r}),e[l]<F()&&k(e,F()),(t=>{t[wt]*=2,t[wt]>=2**31&&(t[wt]=1,t[P].push(new Uint32Array(t[bt])))})(t)},yt=(t,e,n)=>{const i=t[mt].get(e);if(!i)return!1;const{generationId:r,bitflag:o}=i;return(t[P][r][n]&o)===o},xt=(t,e,n,i=!1)=>{if(void 0===n)throw new Error("bitECS - entity is undefined.");if(!t[j].has(n))throw new Error("bitECS - entity does not exist in the world.");if(t[mt].has(e)||gt(t,e),yt(t,e,n))return;const r=t[mt].get(e),{generationId:o,bitflag:a,queries:s,notQueries:h}=r;t[P][o][n]|=a,s.forEach((e=>{e.toRemove.has(n)&&e.toRemove.remove(n);const i=st(t,e,n);i&&ht(e,n),i||ut(t,e,n)})),t[C].get(n).add(e),i&&_(e,n)},bt=Symbol("size"),vt=Symbol("resizeThreshold"),wt=Symbol("bitflag"),St=Symbol("archetypes"),Mt=Symbol("localEntities"),Et=Symbol("localEntityLookp"),At=[],Yt=t=>{At.forEach((e=>{e[bt]=t;for(let n=0;n<e[P].length;n++){const i=e[P][n];e[P][n]=E(i,t)}e[vt]=e[bt]-e[bt]/5}))},kt=(t,e=F())=>(t[bt]=e,t[U]&&t[U].forEach((e=>((t,e)=>{if(t[j].has(e)){t[$].forEach((n=>{ut(t,n,e)})),V.push(e),t[j].remove(e),t[C].delete(e),t[Mt].delete(t[Et].get(e)),t[Et].delete(e);for(let n=0;n<t[P].length;n++)t[P][n][e]=0}})(t,e))),t[P]=[new Uint32Array(e)],t[C]=new Map,t[St]=[],t[j]=I(),t[U]=t[j].dense,t[wt]=1,t[mt]=new Map,t[Z]=new Map,t[$]=new Set,t[K]=new Set,t[tt]=new Set,t[Mt]=new Map,t[Et]=new Map,t),_t=e;const Xt=pt({index:_t.i8}),Bt=pt({x:_t.f32,y:_t.f32}),It=pt({x:_t.f32,y:_t.f32}),Ot=pt({a:_t.f32}),Tt=pt({index:_t.i8}),Rt=pt({index:_t.i32,tick:_t.i32}),Lt=pt({}),Pt=pt({goLeft:_t.i8,goRight:_t.i8,goUp:_t.i8,goDown:_t.i8}),Ct=pt({minX:_t.f32,maxX:_t.f32,minY:_t.f32,maxY:_t.f32}),jt=at([It,Pt]),Ut=at([It,Bt]),Nt=at([Bt,Ot,Rt]),Dt=at([Bt,Ot,Tt]),qt=((...t)=>e=>{let n=e;for(let e=0;e<t.length;e++){n=(0,t[e])(n)}return n})((t=>{const e=jt(t);for(let n=0;n<e.length;n++){const i=e[n];let r=!1;if(yt(t,Ot,i)&&(Pt.goLeft[i]?Ot.a[i]=0:Pt.goDown[i]?Ot.a[i]=1:Pt.goUp[i]?Ot.a[i]=2:Pt.goRight[i]?Ot.a[i]=3:r=!0),yt(t,It,i)){const t=Pt.goLeft[i]?-1:Pt.goRight[i]?1:0,e=Pt.goUp[i]?-1:Pt.goDown[i]?1:0;It.x[i]=.5*t,It.y[i]=.5*e}if(yt(t,Rt,i)){const e=Ot.a[i],n=8*(yt(t,Xt,i)?Xt.index[i]:0);if(r)switch(e){case 0:Rt.index[i]=n+1;break;case 1:Rt.index[i]=n+3;break;case 2:Rt.index[i]=n+5;break;case 3:Rt.index[i]=n+7}else switch(e){case 0:Rt.index[i]=n+0;break;case 1:Rt.index[i]=n+2;break;case 2:Rt.index[i]=n+4;break;case 3:Rt.index[i]=n+6}}}return t}),(t=>{const e=Ut(t);for(let n=0;n<e.length;n++){const i=e[n],r=Bt.x[i]+It.x[i],o=Bt.y[i]+It.y[i];if(yt(t,Ct,i))for(let e=0;e<3;e++){const n=0===e||1===e?r:Bt.x[i],a=0===e||2===e?o:Bt.y[i];if(!t.staticTilemapCollider.collides({minX:n+Ct.minX[i],maxX:n+Ct.maxX[i],minY:a+Ct.minY[i],maxY:a+Ct.maxY[i]})){Bt.x[i]=n,Bt.y[i]=a;break}}else Bt.x[i]=r,Bt.y[i]=o}return t}),(t=>{const{renderer:e}=t,n=Dt(t);for(let t=0;t<n.length;t++){const i=n[t];e.putTile(Tt.index[i],Bt.x[i],Bt.y[i],Ot.a[i],1,1,0)}return t}),(t=>{const{renderer:e}=t,n=Nt(t);for(let i=0;i<n.length;i++){const r=n[i];e.putAnimation(Rt.index[r],Rt.tick[r],Math.round(Bt.x[r]-t.tilemapOrigin.x),Math.round(Bt.y[r]-t.tilemapOrigin.y),0),Rt.tick[r]+=1}return t}));function Ft(t,e,n){var i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),i}function Vt(t,e,n,i){var r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,n,i),r}function Qt(t){var e,n,i,r,o,a,s,h=t.getContext("webgl"),l=40,c=10922,u=t.width,m=t.height,f=function(t,e,n){var i=t.createProgram(),r=Ft(t,e,35633),o=Ft(t,n,35632);return t.attachShader(i,r),t.attachShader(i,o),t.linkProgram(i),i}(h,["precision lowp float;","attribute float a;","attribute vec2 b,c,d,e;","attribute vec4 f;","varying vec2 g;","varying vec4 h;","uniform mat4 i;","void main() {","float q=cos(a);","float w=sin(a);","gl_Position=i*vec4(((vec2(d.x*q-d.y*w,d.x*w+d.y*q)*c)+b),1.0,1.0);","g=e;","h=f;","}"].join("\n"),["precision lowp float;","varying vec2 g;","varying vec4 h;","uniform sampler2D j;","void main(){","gl_FragColor=texture2D(j,g)*h;","}"].join("\n")),d=h.bufferSubData.bind(h),p=h.drawElements.bind(h),g=h.bindTexture.bind(h),y=(h.clear.bind(h),h.clearColor.bind(h),new ArrayBuffer(1747520)),x=new Float32Array(y),b=new Uint32Array(y),v=new Uint16Array(131064),w=Vt(h,34963,v.byteLength,35044),S=Vt(h,34962,y.byteLength,35048),M=0,E=null,A=null;h.blendFunc(770,771),h.enable(3042),h.useProgram(f),h.bindBuffer(34963,w);for(var Y=s=0;Y<65532;Y+=6,s+=4)v[Y+0]=s,v[Y+1]=s+1,v[Y+2]=s+2,v[Y+3]=s+0,v[Y+4]=s+3,v[Y+5]=s+1;h.bufferSubData(34963,0,v),h.bindBuffer(34962,S),e=h.getAttribLocation(f,"a"),n=h.getAttribLocation(f,"b"),i=h.getAttribLocation(f,"c"),r=h.getAttribLocation(f,"d"),o=h.getAttribLocation(f,"e"),a=h.getAttribLocation(f,"f"),h.enableVertexAttribArray(e),h.vertexAttribPointer(e,1,5126,0,l,0),h.enableVertexAttribArray(n),h.vertexAttribPointer(n,2,5126,0,l,4),h.enableVertexAttribArray(i),h.vertexAttribPointer(i,2,5126,0,l,12),h.enableVertexAttribArray(r),h.vertexAttribPointer(r,2,5126,0,l,20),h.enableVertexAttribArray(o),h.vertexAttribPointer(o,2,5126,0,l,28),h.enableVertexAttribArray(a),h.vertexAttribPointer(a,4,5121,1,l,36),h.uniformMatrix4fv(h.getUniformLocation(f,"i"),0,new Float32Array([2/u,0,0,0,0,-2/m,0,0,0,0,1,1,-1,1,0,0])),h.activeTexture(33984);const k=[];return A={g:h,c:t,col:4294967295,bkg:function(t,e,n){h.clearColor(t,e,n,1)},cls:function(){h.clear(16384)},img:function(t,e,n,i,r,o,a,s,h,l,c,u,m,f,d){void 0!==d?k.push([t,e,n,i,r,o,a,s,h,l,c,u,m,f,d]):A.img_real(t,e,n,i,r,o,a,s,h,l,c,u,m,f)},img_real:function(t,e,n,i,r,o,a,s,h,u,m,f,v,w){var S=e,Y=n,k=e+i,_=n+r,X=e,B=n+r,I=e+i,O=n,T=0,R=A.col;(t!=E||M+1>=c)&&(d(34962,0,y),p(4,6*M,5123,0),M=0,t!=E&&g(3553,E=t)),T=M*l,x[T++]=o,x[T++]=a,x[T++]=s,x[T++]=h,x[T++]=u,x[T++]=S,x[T++]=Y,x[T++]=m,x[T++]=f,b[T++]=R,x[T++]=o,x[T++]=a,x[T++]=s,x[T++]=h,x[T++]=u,x[T++]=k,x[T++]=_,x[T++]=v,x[T++]=w,b[T++]=R,x[T++]=o,x[T++]=a,x[T++]=s,x[T++]=h,x[T++]=u,x[T++]=X,x[T++]=B,x[T++]=m,x[T++]=w,b[T++]=R,x[T++]=o,x[T++]=a,x[T++]=s,x[T++]=h,x[T++]=u,x[T++]=I,x[T++]=O,x[T++]=v,x[T++]=f,b[T++]=R,++M>=c&&(d(34962,0,y),p(4,6*M,5123,0),M=0)},flush:function(){k.sort(((t,e)=>t[7]+t[14]-(e[7]+e[14]))),k.forEach((t=>{A.img_real(...t)})),k.length=0,0!=M&&(d(34962,0,x.subarray(0,M*l)),p(4,6*M,5123,0),M=0)}}}const zt=t=>new Promise(((e,n)=>{const i=new Image;i.onload=()=>e(i),i.onerror=n,i.src=t}));function Jt(t,e,n,i,r,o=!0){this.width=i,this.height=r,this.texture=t,this.u0=e/t.width,this.v0=n/t.height,this.u1=this.u0+i/t.width,this.v1=this.v0+r/t.height,o?(this.halfWidth=i/2,this.halfHeight=r/2):(this.halfWidth=0,this.halfHeight=0)}function $t(t,e){this.tileIndexes=t,this.tileCount=t.length,this.period=e}const Kt=async(t,e)=>{var n=Qt(t);n.bkg(0,0,0);const i=(await Promise.all(e.map(zt))).map((t=>function(t,e,n,i){var r=t.createTexture();return t.bindTexture(3553,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.texParameteri(3553,10240,9728),t.texParameteri(3553,10241,9728),t.texImage2D(3553,0,6408,6408,5121,e),t.bindTexture(3553,null),r.width=n,r.height=i,r}(n.g,t,t.width,t.height))),r=[],o=(t,e,i,o,a=1,s=1,h)=>{const l=r[t];n.img(l.texture,-l.halfWidth,-l.halfHeight,l.width,l.height,o,e,i,a,s,l.u0,l.v0,l.u1,l.v1,h)},a=[];return{...n,makeTile:(t,n,o,a,s)=>(r.push(new Jt((t=>i[e.indexOf(t)])(t),n,o,a,s)),r.length-1),putTile:o,makeAnimation:(t,e)=>(a.push(new $t(t,e)),a.length-1),putAnimation:(t,e,n,i,r)=>{const{tileIndexes:s,tileCount:h,period:l}=a[t],c=s[Math.floor(e/l)%h];o(c,n,i,r,1,1,0)}}},Wt=["green","red","violet","helmet","blond","black"],Ht=["left","down","up","right"],Gt=["idle","walk1","walk2"],Zt=Wt.flatMap(((t,e)=>Ht.flatMap(((n,i)=>Gt.flatMap(((r,o)=>({kind:t,direction:n,step:r,rect:{x:368+16*i,width:16,y:0+16*(3*e+o),height:16}}))))))),te=[["idle",10,["idle"]],["walk",10,["walk1","idle","walk2","idle"]]],ee=(Wt.flatMap(((t,e)=>Ht.flatMap(((e,n)=>te.flatMap((([n,i,r],o)=>{const a=r.flatMap(((n,i)=>Zt.filter((i=>i.kind===t&&i.direction===e&&i.step===n))));return{kind:t,direction:e,movement:n,period:i,rects:a.map((t=>t.rect))}})))))),2147483648),ne=1073741824,ie=536870912,re=t=>536870911&t,oe=t=>t.replace(/.*\//,""),ae=(t,e)=>{const n=(t=>{const e=[];return t.tilesets.forEach((t=>{for(let n=0;n<t.tilecount;n++){const i=n+t.firstgid,r=n%t.columns,o=Math.floor(n/t.columns);e[i]={image:t.image,rectangle:[r*t.tilewidth,o*t.tileheight,t.tilewidth,t.tileheight]}}t.tiles.forEach((({id:n,properties:i})=>{const r=n+t.firstgid,o=i?.find((t=>"vertical-sort-tile-offset"===t.name));o&&(e[r].vsort=parseInt(o.value)*t.tileheight)})),t.tiles.forEach((({id:n,objectgroup:i})=>{if(void 0!==i){const r=n+t.firstgid;e[r].collisionShapes=i}}))})),e})(e),i=[];return n.forEach(((e,n)=>{i[n]=t.makeTile(e.image,...e.rectangle)})),{render:function(r){e.layers.map((o=>{o.visible&&o.chunks.forEach(((a,s)=>{a.data.forEach(((s,h)=>{if(0===s)return;const l=re(s);let c=(t=>!!(t&ee))(s)?-1:1,u=(t=>!!(t&ne))(s)?-1:1,m=0;(t=>!!(t&ie))(s)&&(m=Math.PI/2,c*=-1);const f=n[l].vsort,[d,p]=n[l].rectangle.slice(2),g=a.x+h%a.width,y=a.y+Math.floor(h/a.width),x=-1*r.x+o.x+g*e.tilewidth,b=-1*r.y+o.y+y*e.tileheight;t.putTile(i[l],x+d/2,b+p/2,m,c,u,f)}))}))}))},getCollisionShapes:function(){const t=[];return e.layers.map((i=>{i.visible&&i.chunks.forEach(((r,o)=>{r.data.forEach(((o,a)=>{if(0===o)return;const s=function(t,e,i,r,o){if(0===o)return;const a=re(o),[s,h]=n[a].rectangle.slice(2),l=e.x+i.x+r%i.width,c=e.y+i.y+Math.floor(r/i.width);return{x:l*t.tilewidth,y:c*t.tileheight}}(e,i,r,a,o);n[re(o)]?.collisionShapes?.objects.forEach((n=>{const h={x:n.x+s.x,y:n.y+s.y,width:n.width,height:n.height,source:{tilemap:e,layer:i,chunk:r,code:o,codeIdx:a,tileOrigin:s}};t.push(h)}))}))}))})),t}}};var se=n(0),he=n.n(se);const le=(t,e,n)=>Math.max(e,Math.min(t,n)),ce=((t,e)=>{const n=100*t/e,i=document.createElement("style");i.textContent=`\nbody { \n    background-color : black;\n    margin:0;\n    border:0;\n    padding : 0;\n}\ncanvas {\n    background-color : black;\n    image-rendering: pixelated;\n    image-rendering: crisp-edges;\n    width : min(100vw,${n}vh);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);    \n}\n`,document.head.appendChild(i);const r=document.createElement("canvas");return r.width=t,r.height=e,document.body.appendChild(r),r})(320,240);ce.id="canvas";const ue=(()=>{const t={};return document.addEventListener("keydown",(e=>t[e.code]=!0)),document.addEventListener("keyup",(e=>t[e.code]=!1)),t})(),me=["assets/imgs/tilemap_packed.png"],fe=(de="hero-position",{set:t=>localStorage.setItem(de,JSON.stringify(t)),get:()=>JSON.parse(localStorage.getItem(de)),clear:()=>localStorage.removeItem(de)});var de;(async()=>{const t=await Kt(ce,me),e=await fetch("assets/data/map0.json").then((t=>t.json()));((t,e)=>{t.tilesets.forEach((t=>{const n=t.image,i=oe(n),r=e.find((t=>oe(t)===i));t.image=r}))})(e,me);const n=ae(t,e);for(let e=0;e<6;e++){const n=48*e;for(let e=0;e<4;e++){const i=t.makeTile(me[0],16*(23+e),n+0,16,16),r=t.makeTile(me[0],16*(23+e),n+16,16,16),o=t.makeTile(me[0],16*(23+e),n+32,16,16);t.makeAnimation([i,r,i,o],12),t.makeAnimation([i],1)}}const i=((...t)=>{const e="object"==typeof t[0]?t[0]:{},n="number"==typeof t[0]?t[0]:"number"==typeof t[1]?t[1]:F();return kt(e,n),At.push(e),e})();i.renderer=t;for(let t=0;t<10;t++){const e=J(i);xt(i,Bt,e),xt(i,Ot,e),xt(i,Rt,e),xt(i,Lt,e),xt(i,It,e),xt(i,Pt,e),xt(i,Ct,e),xt(i,Xt,e),Ct.minX[e]=-5,Ct.maxX[e]=6,Ct.minY[e]=6,Ct.maxY[e]=8,t<5?(Xt.index[e]=t%6,Bt.x[e]=110+10*t,Bt.y[e]=60+10*(t+3),Rt.tick[e]=2*t,Pt.goRight[e]=1):(Xt.index[e]=0,Bt.x[e]=200+10*t,Bt.y[e]=10*(t+3),Pt.goDown[e]=1,Pt.goLeft[e]=1,Rt.tick[e]=2*t)}const r=J(i);{const t=r;xt(i,Bt,t),xt(i,Ot,t),xt(i,Rt,t),xt(i,Lt,t),xt(i,Pt,t),xt(i,It,t),xt(i,Ct,t),xt(i,Xt,t);const e=fe.get()||{x:160,y:100};Bt.x[t]=e.x,Bt.y[t]=e.y,Ot.a[t]=0,It.x[t]=0,It.y[t]=0,Ct.minX[t]=-5,Ct.maxX[t]=6,Ct.minY[t]=6,Ct.maxY[t]=8,Xt.index[t]=3}const o=(t=>{let e=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return t.layers.forEach((o=>{e=Math.min(e,o.startx*t.tilewidth),n=Math.min(n,o.starty*t.tileheight),i=Math.max(i,(o.startx+o.width)*t.tilewidth),r=Math.max(r,(o.starty+o.height)*t.tileheight)})),t.tilewidth,t.width,t.tileheight,t.height,{minX:e,minY:n,maxX:i,maxY:r,width:i-e,height:r-n}})(e);i.tilemapOrigin={x:o.minX,y:o.minY};const a=new(he()),s=n.getCollisionShapes().map((({x:t,y:e,width:n,height:i,source:r})=>({minX:t,minY:e,maxX:t+n,maxY:e+i,source:r})));a.load(s),i.staticTilemapCollider=a;const h=(()=>{const t={};return function(){const e=Bt.x[r]-i.tilemapOrigin.x,n=Bt.y[r]-i.tilemapOrigin.y,o=Math.floor(5*e/ce.width),a=Math.floor(5*n/ce.height);return o<=0?t.mapLeft=!0:o>=4?t.mapRight=!0:3===o?t.mapLeft=!1:1===o&&(t.mapRight=!1),a<=0?t.mapUp=!0:a>=4?t.mapDown=!0:3===a?t.mapUp=!1:1===a&&(t.mapDown=!1),t}})();(t=>{const e=()=>{const i=performance.now();t((i-n)/1e3,i/1e3),n=i,requestAnimationFrame(e)};let n=performance.now();requestAnimationFrame(e)})(((e,a)=>{const s={mapUp:ue.KeyW,mapLeft:ue.KeyA,mapDown:ue.KeyS,mapRight:ue.KeyD,heroUp:ue.ArrowUp,heroLeft:ue.ArrowLeft,heroDown:ue.ArrowDown,heroRight:ue.ArrowRight};i.commands=s;const l=h();s.mapLeft=s.mapLeft||l.mapLeft,s.mapRight=s.mapRight||l.mapRight,s.mapUp=s.mapUp||l.mapUp,s.mapDown=s.mapDown||l.mapDown,Pt.goUp[r]=s.heroUp,Pt.goLeft[r]=s.heroLeft,Pt.goDown[r]=s.heroDown,Pt.goRight[r]=s.heroRight;const c=1*s.mapLeft?-1:s.mapRight?1:0,u=1*s.mapUp?-1:s.mapDown?1:0;i.tilemapOrigin.x+=c,i.tilemapOrigin.y+=u,i.tilemapOrigin.x=le(i.tilemapOrigin.x,o.minX,o.maxX-ce.width),i.tilemapOrigin.y=le(i.tilemapOrigin.y,o.minY,o.maxY-ce.height),t.cls(),n.render({x:i.tilemapOrigin.x,y:i.tilemapOrigin.y}),qt(i),fe.set({x:Bt.x[r],y:Bt.y[r]}),t.flush()}))})()})()})();